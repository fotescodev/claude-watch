tasks:
  # ═══════════════════════════════════════════════════════════════════════════
  # AUTOMATED E2E TESTING (Simulator)
  # No manual setup required - fully automated
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "E2E1"
    title: "Automated simulator e2e test: notification → UI update → approve"
    description: |
      FULLY AUTOMATED E2E TEST - No manual setup required.

      This test verifies the complete notification flow in the simulator:
      1. Build the app
      2. Boot simulator if needed
      3. Install app
      4. Launch app
      5. Send test push notification
      6. Verify app processes notification (check logs)

      EXECUTION STEPS (Ralph should run these):
      ```bash
      # 1. Get simulator name
      SIMULATOR="Apple Watch Series 11 (46mm)"

      # 2. Boot simulator if not running
      xcrun simctl boot "$SIMULATOR" 2>/dev/null || true

      # 3. Build app
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination "platform=watchOS Simulator,name=$SIMULATOR" build

      # 4. Install app
      xcrun simctl install "$SIMULATOR" \
        ~/Library/Developer/Xcode/DerivedData/ClaudeWatch-*/Build/Products/Debug-watchsimulator/ClaudeWatch.app

      # 5. Launch app
      xcrun simctl launch "$SIMULATOR" com.edgeoftrust.claudewatch

      # 6. Wait for app to initialize
      sleep 2

      # 7. Send test notification
      cat > /tmp/e2e-test-notification.json << 'EOF'
      {
        "aps": {
          "alert": {"title": "E2E Test", "body": "Automated test notification"},
          "sound": "default",
          "category": "CLAUDE_ACTION"
        },
        "requestId": "e2e-test-$(date +%s)",
        "type": "bash",
        "title": "E2E Test Action",
        "description": "echo 'Hello from automated test'"
      }
      EOF
      xcrun simctl push "$SIMULATOR" com.edgeoftrust.claudewatch /tmp/e2e-test-notification.json

      # 8. Verify notification was received (check simulator logs)
      sleep 1
      xcrun simctl spawn "$SIMULATOR" log show --last 10s --predicate 'subsystem == "com.edgeoftrust.claudewatch"' 2>/dev/null || echo "Notification sent successfully"
      ```

      SUCCESS CRITERIA:
      - Build succeeds
      - App installs and launches
      - Notification is delivered to simulator
      - No crashes in app logs
    priority: high
    parallel_group: 1
    completed: false
    verification: |
      SIMULATOR="Apple Watch Series 11 (46mm)"
      xcrun simctl list devices booted | grep -q "Watch" && \
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination "platform=watchOS Simulator,name=$SIMULATOR" build 2>&1 | grep -q "BUILD SUCCEEDED"
    acceptance_criteria:
      - "Build succeeds"
      - "App installs on simulator"
      - "App launches without crash"
      - "Notification delivered to simulator"
    files:
      - "ClaudeWatch/"
    tags:
      - e2e
      - automated
      - simulator
    commit_template: "test(e2e): Automated simulator notification flow"
    status: pending
    assigned_worker: null
    started_at: null
  # ═══════════════════════════════════════════════════════════════════════════
  # FEATURE: Real Task Progress Tracking
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "FE1a"
    title: "Add hook to capture TodoWrite events from Claude Code"
    description: |
      Create PostToolUse hook that intercepts TodoWrite tool calls.
      Parse task list, calculate progress, send to /session-progress endpoint.
      Reference: .claude/hooks/watch-approval-cloud.py
    priority: medium
    parallel_group: 1
    completed: false
    tags:
      - enhancement
      - hooks
      - progress-tracking
    commit_template: "feat(hooks): Add progress tracker for TodoWrite events"
    status: pending
    assigned_worker: null
    started_at: null

  - id: "FE1b"
    title: "Add /session-progress endpoint to Cloudflare worker"
    description: |
      Add POST /session-progress to receive progress from hook.
      Store in KV, send silent push to watch.
      Add GET endpoint for polling fallback.
    priority: medium
    parallel_group: 2
    completed: false
    depends_on:
      - "FE1a"
    tags:
      - enhancement
      - worker
      - progress-tracking
    commit_template: "feat(worker): Add session-progress endpoint"
    status: pending
    assigned_worker: null
    started_at: null

  - id: "FE1c"
    title: "Display task progress in watch MainView"
    description: |
      Add SessionProgress struct to WatchService.
      Handle progress notification type.
      Update StatusHeader to show current task and progress bar.
    priority: medium
    parallel_group: 3
    completed: false
    depends_on:
      - "FE1b"
    tags:
      - enhancement
      - ui
      - progress-tracking
    commit_template: "feat(ui): Display real-time task progress"
    status: pending
    assigned_worker: null
    started_at: null
current_group: 1
