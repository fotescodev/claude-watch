# watchOS Ralph Loop - Task Definition
# This file defines all tasks for the autonomous coding loop.
# Tasks are processed by priority within parallel groups.
#
# ARCHIVE: Completed tasks moved to .claude/archive/ralph/tasks-completed-2026-01-18.yaml
# DONE: APNs, Cloudflare Worker, cc-watch npm package all working

version: "1.0"
project: "ClaudeWatch"
platform: "watchOS"
min_deployment: "10.6"
swift_version: "5.9"
settings:
  require_build_pass: true
  require_accessibility: true
  require_hig_compliance: true
  auto_liquid_glass: true
tasks:
  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE: PHYSICAL DEVICE DEPLOYMENT
  # Goal: Run Claude Code terminal, pair physical watchOS app, approve from walk
  #
  # COMPLETED:
  # - APNs credentials configured in Cloudflare Worker
  # - Cloudflare Worker deployed with APNs support
  # - cc-watch npm package working
  #
  # ⚠️  PAIRING FLOW (IMPORTANT - DO NOT USE OLD METHOD):
  # ────────────────────────────────────────────────────
  # NEW (correct):  Watch shows code → User types code into `npx cc-watch` CLI
  # OLD (obsolete): CLI shows code → User types code into watch app
  #
  # The watch INITIATES pairing and DISPLAYS the code.
  # The CLI COMPLETES pairing by RECEIVING the code.
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "PD1"
    title: "Build and install watch app on physical device"
    description: |
      Build the watch app and install on physical Apple Watch.

      Prerequisites:
      1. Physical Apple Watch paired with your iPhone
      2. Apple Developer account
      3. Provisioning profile for physical device

      Steps:
      1. Open Xcode: `open ClaudeWatch.xcodeproj`
      2. Select your physical watch as destination
      3. Sign with your development team
      4. Build and run (Cmd+R)

      If signing issues:
      - Go to Signing & Capabilities
      - Select your Team
      - Let Xcode manage signing

      The app should appear on your watch's home screen.
    priority: critical
    parallel_group: 1
    completed: true # App already installed on physical watch
    verification: |
      echo "Manual task - verify app installed on physical watch"
    acceptance_criteria:
      - "App builds without errors"
      - "App installs on physical watch"
      - "App launches and shows pairing screen"
    files:
      - "ClaudeWatch.xcodeproj/"
    tags:
      - xcode
      - physical-device
      - manual
    commit_template: "build(watch): Install on physical device"
  - id: "PD2"
    title: "Run pairing flow with physical watch"
    description: |
      Complete pairing between Mac and physical Apple Watch.

      NEW FLOW (watch shows code, CLI reads it):
      1. On physical watch:
         - Open Claude Watch app
         - Tap "Pair Now"
         - Watch displays a 6-digit code

      2. On Mac CLI:
         ```bash
         npx cc-watch
         ```
         - Enter the code FROM the watch INTO the CLI
         - Pairing completes automatically

      3. Verify pairing saved:
         ```bash
         cat ~/.claude-watch/config.json
         ```
         Should contain pairingId

      The hook reads from ~/.claude-watch-pairing, so sync it:
      ```bash
      jq -r .pairingId ~/.claude-watch/config.json > ~/.claude-watch-pairing
      ```
    priority: critical
    parallel_group: 2
    completed: true # Paired successfully
    depends_on:
      - "PD1"
    verification: |
      [ -f ~/.claude-watch-pairing ] && exit 0 || exit 1
    acceptance_criteria:
      - "Pairing helper runs successfully"
      - "Watch shows 'Connected' status"
      - "~/.claude-watch-pairing contains valid UUID"
    files:
      - ".claude/hooks/claude-watch-pair.py"
    tags:
      - pairing
      - physical-device
    commit_template: "test(pairing): Complete physical watch pairing"
  - id: "PD3"
    title: "Enable PreToolUse hook for watch approvals"
    description: |
      Enable the hook that routes Claude Code permission prompts to the watch.

      The hook is in .claude/settings.json but currently disabled (PreToolUse: []).

      To enable:
      ```bash
      ./.claude/hooks/toggle-watch-hooks.sh
      ```

      Or manually edit .claude/settings.json:
      ```json
      "PreToolUse": [
        {
          "matcher": "Bash|Write|Edit|MultiEdit",
          "hooks": [
            {
              "type": "command",
              "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/watch-approval-cloud.py"
            }
          ]
        }
      ]
      ```

      Note: In dev mode, you may want hooks disabled. Toggle as needed.
    priority: high
    parallel_group: 3
    completed: true # Hook enabled
    depends_on:
      - "PD2"
    verification: |
      jq -e '.hooks.PreToolUse | length > 0' .claude/settings.json >/dev/null 2>&1
    acceptance_criteria:
      - "PreToolUse hook enabled in settings.json"
      - "Hook points to watch-approval-cloud.py"
      - "Matcher includes Bash|Write|Edit|MultiEdit"
    files:
      - ".claude/settings.json"
      - ".claude/hooks/toggle-watch-hooks.sh"
    tags:
      - hooks
      - configuration
    commit_template: "feat(hooks): Enable watch approval hook"
  - id: "PD4"
    title: "Test end-to-end approval flow (THE DOG WALK TEST)"
    description: |
      THE FINAL TEST: Walk your dog while approving Claude Code requests.

      SIMULATOR TEST: ✅ PASSED (2026-01-18)
      - Notification received correctly
      - Main view updates live when request arrives
      - Approve/Reject buttons functional
      - MainActor fix deployed

      E2E TEST: ✅ PASSED (2026-01-18)
      - Hook blocks Claude Code until watch approval
      - Push notification arrives when app backgrounded
      - Approve from watch → Claude Code proceeds
      - Full remote control flow verified

      Setup:
      1. Physical watch paired and app running
      2. APNs configured and working (DONE)
      3. PreToolUse hook enabled
      4. Claude Code running on Mac

      Test Steps:
      1. Start Claude Code session on Mac
      2. Ask Claude to make a file change (e.g., "add a comment to MainView.swift")
      3. Physical watch should:
         - Receive push notification (may take 1-2 seconds)
         - Show request details
         - Provide Approve/Reject buttons
      4. Tap Approve on watch
      5. Claude Code should continue and make the change
      6. Test rejection: Ask for another change, tap Reject
      7. Claude Code should stop and report rejection

      Go for a walk:
      - Leave Mac running Claude Code
      - Walk away with watch
      - Approve/reject from anywhere with internet
    priority: critical
    parallel_group: 4
    completed: true
    depends_on:
      - "PD3"
    verification: |
      echo "Manual testing task - mark complete after successful walk test"
    acceptance_criteria:
      - "Push notification received on physical watch"
      - "Request details displayed correctly"
      - "Approve proceeds Claude Code action"
      - "Reject stops Claude Code action"
      - "Works while walking away from Mac"
      - "Latency acceptable (< 5 seconds)"
    files: []
    tags:
      - testing
      - e2e
      - physical-device
      - manual
    commit_template: "test(e2e): Verify physical watch approval flow"
  # ═══════════════════════════════════════════════════════════════════════════
  # BUG FIXES - READY FOR VERIFICATION
  # Simulator: Apple Watch Series 11 (46mm) - SHOULD BE RUNNING
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "BF1"
    title: "Verify notification fixes: live update + cleanup"
    description: |
      TWO FIXES IMPLEMENTED - NEED VERIFICATION:

      FIX 1: Live UI update from push notifications
      - Problem: Notification arrived but MainView showed "All Clear"
      - Solution: Added `addPendingActionFromNotification()` in ClaudeWatchApp.swift
      - Called in `willPresent` when notification arrives
      - Also called when user taps notification to open app

      FIX 2: Clear notifications after approve/reject
      - Problem: Old notifications stayed in notification center
      - Solution: Added `clearDeliveredNotification(for:)` in WatchService.swift
      - Called after respondToCloudRequest, approveAction, rejectAction
      - approveAll clears ALL delivered notifications

      VERIFICATION STEPS (run these commands):
      ```bash
      # 1. Build and install (simulator should be running)
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination 'platform=watchOS Simulator,name=Apple Watch Series 11 (46mm)' build

      # 2. Install app
      xcrun simctl install "Apple Watch Series 11 (46mm)" \
        ~/Library/Developer/Xcode/DerivedData/ClaudeWatch-*/Build/Products/Debug-watchsimulator/ClaudeWatch.app

      # 3. Launch app
      xcrun simctl launch "Apple Watch Series 11 (46mm)" com.edgeoftrust.claudewatch

      # 4. Send test notification
      cat > /tmp/test.json << 'EOF'
      {
        "aps": {"alert": {"title": "Test", "body": "Verify fix"}, "sound": "default", "category": "CLAUDE_ACTION"},
        "requestId": "verify-001", "type": "bash", "title": "Test Action", "description": "Verify notification fix"
      }
      EOF
      xcrun simctl push "Apple Watch Series 11 (46mm)" com.edgeoftrust.claudewatch /tmp/test.json

      # 5. VERIFY: MainView should show "Test Action" with approve/reject buttons
      # 6. Approve the action
      # 7. VERIFY: Notification should disappear from notification center
      # 8. VERIFY: MainView should return to "All Clear"
      ```

      If all verifications pass, mark this task complete and commit.
    priority: critical
    parallel_group: 1
    completed: true
    verification: |
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination 'platform=watchOS Simulator,name=Apple Watch Series 11 (46mm)' build 2>&1 | grep -q "BUILD SUCCEEDED"
    acceptance_criteria:
      - "MainView updates live when notification arrives"
      - "Notification cleared after approve"
      - "Notification cleared after reject"
      - "No stale notifications in notification center"
    files:
      - "ClaudeWatch/App/ClaudeWatchApp.swift"
      - "ClaudeWatch/Services/WatchService.swift"
    tags:
      - bug-fix
      - notifications
      - verification-needed
    commit_template: "fix(notifications): Live UI update + clear after approval"
  - id: "BF2"
    title: "Fix progress card to reflect actual pending state"
    description: |
      BUG: Progress card shows "Ready for tasks 0%" even when:
      - There are pending actions waiting for approval
      - Status is .waiting

      EXPECTED BEHAVIOR:
      - When pendingActions.count > 0: Show "1 action pending" (or count)
      - When status is .waiting: Don't show "Ready for tasks"
      - Progress bar should reflect pending vs completed actions

      IMPLEMENTATION:
      1. Find the progress card view in MainView.swift or similar
      2. Update to read from WatchService.shared.state.pendingActions
      3. Show appropriate text based on state:
         - .idle + no pending → "Ready for tasks"
         - .waiting + pending → "N action(s) pending"
         - .running → "Working..."
      4. Progress bar: pendingActions.isEmpty ? 100% : based on queue

      FILES TO CHECK:
      - ClaudeWatch/Views/MainView.swift
      - Look for "Ready for tasks" string
      - Look for progress bar / percentage display

      VERIFICATION:
      1. Send test notification
      2. Progress card should update to show pending action
      3. After approve, should return to "Ready for tasks"
    priority: high
    parallel_group: 2
    completed: true
    depends_on:
      - "BF1"
    verification: |
      grep -r "Ready for tasks" ClaudeWatch/Views/
    acceptance_criteria:
      - "Progress card shows pending count when actions waiting"
      - "Progress card shows 'Ready' only when truly idle"
      - "Progress bar reflects actual state"
    files:
      - "ClaudeWatch/Views/MainView.swift"
    tags:
      - bug-fix
      - ui
    commit_template: "fix(ui): Progress card reflects actual pending state"
  # ═══════════════════════════════════════════════════════════════════════════
  # AUTOMATED E2E TESTING (Simulator)
  # No manual setup required - fully automated
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "E2E1"
    title: "Automated simulator e2e test: notification → UI update → approve"
    description: |
      FULLY AUTOMATED E2E TEST - No manual setup required.

      This test verifies the complete notification flow in the simulator:
      1. Build the app
      2. Boot simulator if needed
      3. Install app
      4. Launch app
      5. Send test push notification
      6. Verify app processes notification (check logs)

      EXECUTION STEPS (Ralph should run these):
      ```bash
      # 1. Get simulator name
      SIMULATOR="Apple Watch Series 11 (46mm)"

      # 2. Boot simulator if not running
      xcrun simctl boot "$SIMULATOR" 2>/dev/null || true

      # 3. Build app
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination "platform=watchOS Simulator,name=$SIMULATOR" build

      # 4. Install app
      xcrun simctl install "$SIMULATOR" \
        ~/Library/Developer/Xcode/DerivedData/ClaudeWatch-*/Build/Products/Debug-watchsimulator/ClaudeWatch.app

      # 5. Launch app
      xcrun simctl launch "$SIMULATOR" com.edgeoftrust.claudewatch

      # 6. Wait for app to initialize
      sleep 2

      # 7. Send test notification
      cat > /tmp/e2e-test-notification.json << 'EOF'
      {
        "aps": {
          "alert": {"title": "E2E Test", "body": "Automated test notification"},
          "sound": "default",
          "category": "CLAUDE_ACTION"
        },
        "requestId": "e2e-test-$(date +%s)",
        "type": "bash",
        "title": "E2E Test Action",
        "description": "echo 'Hello from automated test'"
      }
      EOF
      xcrun simctl push "$SIMULATOR" com.edgeoftrust.claudewatch /tmp/e2e-test-notification.json

      # 8. Verify notification was received (check simulator logs)
      sleep 1
      xcrun simctl spawn "$SIMULATOR" log show --last 10s --predicate 'subsystem == "com.edgeoftrust.claudewatch"' 2>/dev/null || echo "Notification sent successfully"
      ```

      SUCCESS CRITERIA:
      - Build succeeds
      - App installs and launches
      - Notification is delivered to simulator
      - No crashes in app logs
    priority: high
    parallel_group: 1
    completed: true
    verification: |
      SIMULATOR="Apple Watch Series 11 (46mm)"
      xcrun simctl list devices booted | grep -q "Watch" && \
      xcodebuild -project ClaudeWatch.xcodeproj -scheme ClaudeWatch \
        -destination "platform=watchOS Simulator,name=$SIMULATOR" build 2>&1 | grep -q "BUILD SUCCEEDED"
    acceptance_criteria:
      - "Build succeeds"
      - "App installs on simulator"
      - "App launches without crash"
      - "Notification delivered to simulator"
    files:
      - "ClaudeWatch/"
    tags:
      - e2e
      - automated
      - simulator
    commit_template: "test(e2e): Automated simulator notification flow"
  # ═══════════════════════════════════════════════════════════════════════════
  # FEATURE VERIFICATION (PRD Alignment)
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "FV1"
    title: "Verify Permission Mode Control (Normal/Auto-Accept/Plan)"
    description: |
      PRD Feature #3: Permission Mode Control

      The mode toggle should cycle through:
      - Normal (Blue): Approve each action individually
      - Auto-Accept (Red): Automatically approve all actions
      - Plan (Purple): Read-only planning, no execution

      VERIFICATION:
      1. Find mode toggle in MainView or relevant view
      2. Verify modes cycle correctly on tap
      3. Verify mode colors match PRD spec
      4. Test that mode persists across app restarts
      5. Verify mode is communicated to server/Claude Code

      FILES TO CHECK:
      - ClaudeWatch/Views/MainView.swift (look for mode toggle)
      - ClaudeWatch/Services/WatchService.swift (mode state)
    priority: medium
    parallel_group: 3
    completed: true
    depends_on:
      - "BF2"
    acceptance_criteria:
      - "Mode cycles: Normal → Auto-Accept → Plan → Normal"
      - "Colors match PRD spec"
      - "Mode state persists"
    files:
      - "ClaudeWatch/Views/MainView.swift"
    tags:
      - verification
      - prd-alignment
    commit_template: "test(modes): Verify permission mode control"
  - id: "FV2"
    title: "Verify Quick Commands functionality"
    description: |
      PRD Feature #4: Quick Commands

      Voice commands or preset actions to Claude Code:
      - Go: Resume/start task
      - Stop: Pause execution
      - Cancel: Abort current task

      VERIFICATION:
      1. Check CommandViews.swift for implementation
      2. Verify commands send correct messages to server
      3. Test each preset command works
      4. Verify voice command integration (if implemented)

      FILES:
      - ClaudeWatch/Views/CommandViews.swift
      - ClaudeWatch/Services/WatchService.swift (command sending)
    priority: medium
    parallel_group: 3
    completed: true
    depends_on:
      - "BF2"
    acceptance_criteria:
      - "Quick command buttons visible and functional"
      - "Commands sent to server correctly"
      - "UI feedback on command execution"
    files:
      - "ClaudeWatch/Views/CommandViews.swift"
    tags:
      - verification
      - prd-alignment
    commit_template: "test(commands): Verify quick commands"
  - id: "FV3"
    title: "Verify Watch Face Complications"
    description: |
      PRD Feature #5: Watch Face Complications

      Complications should show:
      - Connection status
      - Pending action count
      - Current task status

      VERIFICATION:
      1. Check ComplicationViews.swift implementation
      2. Add complication to watch face in simulator
      3. Verify data updates when state changes
      4. Test all complication families (circular, rectangular, etc.)

      HOW TO TEST IN SIMULATOR:
      1. Long-press watch face
      2. Tap "Edit"
      3. Add Claude Watch complication
      4. Verify it shows correct data

      FILES:
      - ClaudeWatch/Complications/ComplicationViews.swift
    priority: low
    parallel_group: 4
    completed: true
    depends_on:
      - "FV1"
    acceptance_criteria:
      - "Complications appear in watch face editor"
      - "Show pending count when actions waiting"
      - "Update when state changes"
    files:
      - "ClaudeWatch/Complications/ComplicationViews.swift"
    tags:
      - verification
      - complications
    commit_template: "test(complications): Verify watch face complications"
  - id: "FV4"
    title: "Test rejection flow end-to-end"
    description: |
      Verify that rejecting an action from the watch:
      1. Sends rejection to cloud server
      2. Cloud notifies the PreToolUse hook
      3. Claude Code receives rejection and stops
      4. Error/rejection message shown to user

      VERIFICATION:
      1. Enable PreToolUse hook: ./.claude/hooks/toggle-watch-hooks.sh on
      2. Start Claude Code session
      3. Ask Claude to make an edit
      4. REJECT from watch
      5. Verify Claude Code shows rejection message
      6. Verify it doesn't proceed with the edit

      Note: This requires the PreToolUse hook enabled.
    priority: medium
    parallel_group: 3
    completed: true
    depends_on:
      - "BF1"
    acceptance_criteria:
      - "Rejection sent to cloud"
      - "Hook receives rejection"
      - "Claude Code stops and reports rejection"
    files: []
    tags:
      - e2e
      - testing
    commit_template: "test(rejection): Verify rejection flow e2e"
  - id: "FV5"
    title: "Physical watch dog walk test"
    description: |
      THE ULTIMATE TEST: Deploy to physical watch and test while walking.

      PREREQUISITES:
      - Physical Apple Watch paired with iPhone
      - App installed on physical watch (via Xcode)
      - PreToolUse hook enabled

      TEST STEPS:
      1. Pair physical watch: npx cc-watch (enter code from watch)
      2. Enable hook: ./.claude/hooks/toggle-watch-hooks.sh on
      3. Start Claude Code session on Mac
      4. Walk away from Mac with watch
      5. Ask Claude to make an edit (via phone/remote)
      6. Approve from watch while walking
      7. Verify edit completes on Mac

      SUCCESS CRITERIA:
      - Notification arrives within 5 seconds
      - Approve works over cellular/WiFi
      - Full round-trip works away from Mac
    priority: high
    parallel_group: 5
    completed: true
    depends_on:
      - "FV4"
    acceptance_criteria:
      - "Works on physical watch"
      - "Works away from Mac (cellular/WiFi)"
      - "Latency < 5 seconds"
    files: []
    tags:
      - e2e
      - physical-device
      - manual
    commit_template: "test(physical): Dog walk test passed"
  # ═══════════════════════════════════════════════════════════════════════════
  # FEATURE: Real Task Progress Tracking
  # Shows actual Claude Code session activity on the watch
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "FE1a"
    title: "Add hook to capture TodoWrite events from Claude Code"
    description: |
      Create a PostToolUse hook that intercepts TodoWrite tool calls
      and extracts the task list with statuses.

      IMPLEMENTATION:
      1. Create .claude/hooks/progress-tracker.py
      2. Hook triggers on PostToolUse for TodoWrite tool
      3. Parse the todo list from tool input:
         - Extract task content, status (pending/in_progress/completed)
         - Calculate progress: completed_count / total_count
         - Get current in_progress task name
      4. Send to Cloudflare worker endpoint: POST /session-progress
         ```json
         {
           "pairingId": "<from ~/.claude-watch-pairing>",
           "sessionId": "<unique session identifier>",
           "tasks": [
             {"content": "Task 1", "status": "completed"},
             {"content": "Task 2", "status": "in_progress"},
             {"content": "Task 3", "status": "pending"}
           ],
           "currentTask": "Task 2",
           "progress": 0.33
         }
         ```
      5. Register hook in .claude/settings.json under PostToolUse

      REFERENCE FILES:
      - .claude/hooks/watch-approval-cloud.py (example of sending to worker)
      - .claude/settings.json (hook registration format)

      TEST:
      ```bash
      # Simulate TodoWrite call
      echo '{"tool": "TodoWrite", "input": {"todos": [{"content": "Test", "status": "completed"}]}}' | python3 .claude/hooks/progress-tracker.py
      ```
    priority: medium
    parallel_group: 1
    completed: true
    verification: |
      [ -f .claude/hooks/progress-tracker.py ] && \
      grep -q "PostToolUse" .claude/settings.json && \
      grep -q "TodoWrite" .claude/hooks/progress-tracker.py
    acceptance_criteria:
      - "Hook file exists at .claude/hooks/progress-tracker.py"
      - "Hook registered in settings.json for PostToolUse"
      - "Hook parses TodoWrite input correctly"
      - "Hook sends progress to /session-progress endpoint"
      - "Hook reads pairingId from ~/.claude-watch-pairing"
    files:
      - ".claude/hooks/progress-tracker.py"
      - ".claude/settings.json"
    tags:
      - enhancement
      - hooks
      - progress-tracking
    commit_template: "feat(hooks): Add progress tracker for TodoWrite events"
  - id: "FE1b"
    title: "Add /session-progress endpoint to Cloudflare worker"
    description: |
      Extend the Cloudflare worker to receive session progress and push to watch.

      IMPLEMENTATION:
      1. Add POST /session-progress endpoint to MCPServer/worker/src/index.ts
      2. Validate request has pairingId and progress data
      3. Store latest progress in KV:
         - Key: `progress:${pairingId}`
         - Value: JSON with tasks, currentTask, progress, timestamp
      4. Send silent push notification to watch with progress update:
         ```json
         {
           "aps": {
             "content-available": 1
           },
           "type": "progress",
           "currentTask": "Task name",
           "progress": 0.33,
           "completedCount": 1,
           "totalCount": 3
         }
         ```
      5. Add GET /session-progress/:pairingId for watch to poll (fallback)

      REFERENCE FILES:
      - MCPServer/worker/src/index.ts (existing endpoints)
      - Look at /request endpoint for APNs push pattern

      TEST:
      ```bash
      curl -X POST https://claude-watch.example.workers.dev/session-progress \
        -H "Content-Type: application/json" \
        -d '{"pairingId": "test-123", "currentTask": "Building", "progress": 0.5}'
      ```
    priority: medium
    parallel_group: 2
    completed: false
    depends_on:
      - "FE1a"
    verification: |
      grep -q "session-progress" MCPServer/worker/src/index.ts
    acceptance_criteria:
      - "POST /session-progress endpoint exists"
      - "Progress stored in KV"
      - "Silent push sent to watch"
      - "GET endpoint for polling fallback"
    files:
      - "MCPServer/worker/src/index.ts"
    tags:
      - enhancement
      - worker
      - progress-tracking
    commit_template: "feat(worker): Add session-progress endpoint"
  - id: "FE1c"
    title: "Display task progress in watch MainView"
    description: |
      Update MainView to show real-time task progress from Claude Code.

      IMPLEMENTATION:
      1. Add progress state to WatchService:
         ```swift
         struct SessionProgress {
           var currentTask: String?
           var progress: Double  // 0.0 to 1.0
           var completedCount: Int
           var totalCount: Int
         }
         var sessionProgress: SessionProgress?
         ```

      2. Handle "progress" notification type in ClaudeWatchApp.swift:
         - Parse progress payload from notification
         - Update WatchService.shared.sessionProgress

      3. Update StatusHeader in MainView.swift:
         - When sessionProgress != nil:
           - Show "Working on: [currentTask]"
           - Show progress bar with actual percentage
           - Show "2/6 tasks" count
         - When sessionProgress == nil:
           - Show current idle/waiting state (existing behavior)

      4. Add progress bar view:
         ```swift
         ProgressView(value: progress.progress)
           .progressViewStyle(.linear)
         ```

      UI MOCKUP:
      ```
      ┌─────────────────────┐
      │ Working on:         │
      │ "Running tests"     │
      │ ████████░░░░ 66%    │
      │ 4/6 tasks           │
      └─────────────────────┘
      ```

      REFERENCE:
      - ClaudeWatch/Views/MainView.swift (StatusHeader)
      - ClaudeWatch/Services/WatchService.swift (state management)

      TEST:
      Send test notification:
      ```bash
      xcrun simctl push "Apple Watch Series 11 (46mm)" com.edgeoftrust.claudewatch /tmp/progress-test.json
      ```
      With payload:
      ```json
      {
        "aps": {"content-available": 1},
        "type": "progress",
        "currentTask": "Running tests",
        "progress": 0.66,
        "completedCount": 4,
        "totalCount": 6
      }
      ```
    priority: medium
    parallel_group: 3
    completed: false
    depends_on:
      - "FE1b"
    verification: |
      grep -q "SessionProgress" ClaudeWatch/Services/WatchService.swift && \
      grep -q "currentTask" ClaudeWatch/Views/MainView.swift
    acceptance_criteria:
      - "SessionProgress struct added to WatchService"
      - "Progress notification handler in ClaudeWatchApp"
      - "MainView shows current task name"
      - "Progress bar displays actual percentage"
      - "Task count shown (X/Y tasks)"
      - "Falls back to idle state when no progress"
    files:
      - "ClaudeWatch/Views/MainView.swift"
      - "ClaudeWatch/Services/WatchService.swift"
      - "ClaudeWatch/App/ClaudeWatchApp.swift"
    tags:
      - enhancement
      - ui
      - progress-tracking
    commit_template: "feat(ui): Display real-time task progress"
  # ═══════════════════════════════════════════════════════════════════════════
  # BLOCKED/DEFERRED TASKS
  # ═══════════════════════════════════════════════════════════════════════════
  - id: "SP1"
    title: "Add clipboard paste button for pairing"
    description: |
      BLOCKED: UIPasteboard is NOT available on watchOS.

      Requires WatchConnectivity + iPhone companion app.
      Deferred until after physical device flow works.
    priority: low
    parallel_group: 99
    completed: true # Marked complete to skip
    blocked: true
    blocked_reason: "UIPasteboard not available on watchOS. Requires iPhone companion app."
    verification: |
      exit 0  # Skip
    acceptance_criteria:
      - "DEFERRED - requires iPhone companion app"
    files: []
    tags:
      - pairing
      - blocked
      - deferred
    commit_template: "feat(pairing): Add clipboard paste (deferred)"
